# Artifact A28: aiascent.dev - Dual Embedding RAG Architecture

# Date Created: C26
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** A guide for implementing and managing a dual-embedding RAG system, allowing the chat assistant to use different knowledge bases for different sections of the website.
- **Tags:** documentation, rag, chat, ascentia, embeddings, faiss, architecture, multi-tenancy

## 1. Overview and Goal

The `aiascent.dev` website features two distinct interactive reports: the main "Ascent Report" on the `/showcase` page and the "Process as Asset" whitepaper on the homepage. Each requires a different knowledge base for the "Ask @Ascentia" RAG feature to function correctly.

The goal of this plan is to implement a dual-embedding architecture that allows the backend chat API to dynamically load the correct knowledge base based on where the user's request originates.

## 2. Knowledge Base Definitions

The system will support two distinct knowledge bases:

1.  **`report`:**
    *   **Content:** Based on research about the "fissured workplace," cognitive security, and geopolitical AI strategy.
    *   **Usage:** For the `/showcase` page.
    *   **Files:** `report_faiss.index`, `report_chunks.json`.

2.  **`dce`:**
    *   **Content:** Based on the collection of documentation artifacts (`A*.md` files) that describe the Data Curation Environment (DCE) tool, its workflow, and its philosophy.
    *   **Usage:** For the interactive whitepaper on the homepage.
    *   **Files:** `dce_faiss.index`, `dce_chunks.json`.

## 3. Curator Action: Creating the `dce` Embedding

1.  **Generate Source File:** Create a single flattened markdown file (e.g., `dce_artifacts.md`) that concatenates the content of all relevant DCE documentation artifacts.
2.  **Run Embedding Script:** Use the `create_report_embedding.js` script to process this new source file.
    ```bash
    node context/aiascentgame/scripts/create_report_embedding.js C:/Projects/aiascent-dev/context/dce/dce_kb.md
    ```
3.  **Rename Output:** The script will output `report_faiss.index` and `report_chunks.json`. **Rename these files** to `dce_faiss.index` and `dce_chunks.json` respectively.
4.  **Place Files:** Place all four embedding files (`report_*` and `dce_*`) into the `public/data/embeddings/` directory.

## 4. Technical Implementation Plan

### 4.1. Backend API (`/api/chat/route.ts`) Modification

The chat API will be updated to be "knowledge base aware."

1.  **Update Request Body:** The `POST` request handler will be modified to accept a new field: `knowledgeBase: 'report' | 'dce'`.
2.  **Dynamic File Loading:** The handler will use this new field to dynamically construct the paths to the correct embedding files.
    ```typescript
    // Example logic in /api/chat/route.ts
    const { prompt, pageContext, knowledgeBase = 'report' } = await request.json();

    const faissFile = `${knowledgeBase}_faiss.index`;
    const chunksFile = `${knowledgeBase}_chunks.json`;

    const faissPath = path.join(process.cwd(), 'public', 'data', 'embeddings', faissFile);
    const chunksPath = path.join(process.cwd(), 'public', 'data', 'embeddings', chunksFile);
    
    // ... proceed to load these files
    ```
3.  **Dynamic System Prompt:** The API will also use the `knowledgeBase` value to select the correct system prompt for Ascentia's persona, as defined in `A27`.

### 4.2. Frontend Component Modifications

The frontend needs to be updated to send the `knowledgeBase` identifier with each request.

1.  **`ReportViewer.tsx`:**
    *   This component already accepts a `reportName` prop (`"showcase"` or `"whitepaper"`). It will be modified to pass this prop down to its child, `ReportChatPanel`.

2.  **`ReportChatPanel.tsx`:**
    *   It will accept the `reportName` prop.
    *   In its `handleSend` function, it will map this prop to the `knowledgeBase` identifier and include it in the JSON body of the `fetch` request.
    ```typescript
    // Example logic in ReportChatPanel.tsx handleSend function
    const knowledgeBase = reportName === 'whitepaper' ? 'dce' : 'report';

    const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            prompt: trimmedInput, 
            pageContext,
            knowledgeBase: knowledgeBase // Send the identifier
        }),
    });
    ```

This architecture provides a clean and scalable way to support multiple, distinct knowledge bases, making the "Ask @Ascentia" feature more powerful and contextually accurate across the entire website.