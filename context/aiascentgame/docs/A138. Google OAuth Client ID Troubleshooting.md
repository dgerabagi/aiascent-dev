# Artifact: A138. Google OAuth Client ID Troubleshooting
# Artifact 138: Google OAuth Client ID Troubleshooting Guide
# Updated on: C1167 (Clarified that the Express server runs on port 3001, but the browser-facing dev server is on 8867.)
# Date Created: Cycle 1163
# Author: AI Model

## 1. Purpose

This guide provides a focused, step-by-step process to diagnose and fix the `Error 400: redirect_uri_mismatch` error encountered when using Google Sign-In with NextAuth.js. This error indicates a configuration mismatch between your application and your project settings in the Google Cloud Console.

## 2. Root Cause

The error occurs because the `redirect_uri` your application sends to Google must **exactly match** one of the URIs you have authorized in the Google Cloud Console.

*   Your application's public-facing URL in development is `http://localhost:8867` (the Webpack Dev Server).
*   Your backend authentication server runs on `http://localhost:3001` (the Express server).
*   The `NEXTAUTH_URL` environment variable is set to `http://localhost:8867`.
*   NextAuth.js uses this to automatically construct the callback URL it sends to Google, which is: `http://localhost:8867/api/auth/callback/google`.
*   If this exact URL is not in your Google Console's list of "Authorized redirect URIs", Google will reject the request.

## 3. Step-by-Step Fix

Follow these steps to add the correct URI and resolve the error.

### 3.1. Navigate to the Google Cloud Console

1.  Go to the Google Cloud Console: [https://console.cloud.google.com/](https://console.cloud.google.com/)
2.  Log in with the Google account you used to create the project.
3.  From the project selection dropdown at the top of the page, **ensure you have selected the correct project** (e.g., "aiascent").

### 3.2. Locate Your OAuth Client ID

1.  Open the navigation menu (the "hamburger" icon â˜° in the top-left).
2.  Navigate to **APIs & Services > Credentials**.
3.  On the Credentials page, look for the section titled **"OAuth 2.0 Client IDs"**.
4.  You should see the client you created. Click on its name (e.g., "AI Ascent Web Client" or "Web client 1") to open its details page.

### 3.3. Add the Correct Authorized Redirect URI

1.  On the client details page, find the section labeled **"Authorized redirect URIs"**.
2.  Click **"+ ADD URI"**.
3.  A new text box will appear. Paste the following value **exactly**:
    ```
    http://localhost:8867/api/auth/callback/google
    ```
4.  Press `Enter` or click away to confirm the entry. You should now have this URI in your list. It's safe to remove any old `localhost:3001` entries to avoid confusion.

**Why this specific URI?**
*   **`http://localhost:8867`**: This is the public-facing address and port of your Webpack dev server, which is the entry point for your application in development. This is what the browser sees and what `NEXTAUTH_URL` should be set to.
*   **`/api/auth/callback/google`**: This is the specific path that NextAuth.js expects Google to redirect to after a successful sign-in. Even though our Express server handles this request on port 3001, the Webpack proxy makes it appear to come from port 8867 to the outside world (and to Google).

### 3.4. Save and Restart

1.  At the bottom of the Google Cloud Console credentials page, click the **"Save"** button. It may take a minute or two for the changes to apply across Google's systems.
2.  Go back to your terminal where `npm run serve` is running.
3.  Stop the server by pressing `Ctrl + C`.
4.  Restart the server by running `npm run serve` again.
5.  Open a new browser tab (or an incognito window to be safe) and try the Google Sign-In flow again. The error should now be resolved.
