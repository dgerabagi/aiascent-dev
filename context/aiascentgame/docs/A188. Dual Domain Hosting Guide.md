# Artifact A188: Dual Domain Hosting Guide

- **Key/Value for A0:**
- **Description:** A comprehensive guide for setting up a single server to host both `aiascent.game` and `aiascent.dev` using Caddy as a reverse proxy and PM2 as a process manager.
- **Tags:** guide, hosting, deployment, server, v1.0, caddy, reverse proxy, pm2, multi-domain

## 1. Purpose

This guide provides a complete, step-by-step process for deploying both the `aiascent.game` and `aiascent.dev` applications onto a single server. It covers cloning the new repository, building both applications for production, configuring the Caddy reverse proxy to handle both domains, and using the PM2 process manager to keep both applications running reliably.

## 2. Architecture Overview

The setup uses a **reverse proxy** architecture. A single Caddy web server listens for all public web traffic on ports 80 and 443. Based on the domain name requested by the user (`aiascent.game` or `aiascent.dev`), Caddy forwards the request to the correct application running on a separate, internal port.

*   `aiascent.game` will run on port **3001**.
*   `aiascent.dev` will run on port **3002**.
*   **PM2**, a process manager for Node.js, will be used to run both applications as background services, ensuring they restart automatically if they crash.

## 3. Step-by-Step Deployment on the Server

### Step 3.1: Prepare the `aiascent-dev` Application

1.  **Clone the Repository:**
    *   Navigate to your main projects directory (e.g., `C:\Projects\`).
    *   Clone the `aiascent-dev` repository from GitHub.
    ```bash
    git clone https://github.com/dgerabagi/aiascent-dev.git
    ```

2.  **Install Dependencies:**
    *   Navigate into the new directory: `cd aiascent-dev`.
    *   Install all required packages: `npm install`.

3.  **Create `.env` File:**
    *   Create a `.env` file in the root of the `aiascent-dev` project. This file is for production secrets.
    *   Add the necessary environment variables. For this project, it's primarily for the RAG and TTS features.
    ```
    # .env for aiascent-dev
    TTS_SERVER_URL=http://<IP_OF_TTS_SERVER>:8880/v1/audio/speech
    REMOTE_LLM_URL=http://<IP_OF_LLM_SERVER>:1234
    EMBEDDING_API_URL=http://<IP_OF_LLM_SERVER>:1234/v1/embeddings
    ```

4.  **Build for Production:**
    *   Run the build script to create an optimized production version of the Next.js site.
    ```bash
    npm run build
    ```

### Step 3.2: Prepare the `ai-ascent` Application

1.  **Navigate to Project:** Go to your `ai-ascent` project directory.
2.  **Update Caddyfile:** Ensure the `Caddyfile` in the root of this project has been updated with the configuration for both domains as specified in this cycle's changes.
3.  **Build for Production:**
    *   Run the main build script to compile the server and client.
    ```bash
    npm run build
    ```

### Step 3.3: Install and Configure PM2

1.  **Install PM2 Globally:** PM2 is a powerful process manager that will keep your applications online.
    ```bash
    npm install pm2 -g
    ```

2.  **Start the Applications with PM2:**
    *   From the `ai-ascent-dev` directory, start the website:
    ```bash
    pm2 start npm --name "aiascent-dev" -- run start
    ```
    *   From the `ai-ascent` directory, start the game server:
    ```bash
    pm2 start npm --name "ai-ascent" -- run start
    ```

3.  **Verify PM2 Status:** Check that both applications are running and online.
    ```bash
    pm2 list
    ```
    You should see `aiascent-dev` and `ai-ascent` with a green "online" status.

4.  **Save the PM2 Process List:** This command saves the current list of running applications so they will automatically restart when the server reboots.
    ```bash
    pm2 save
    ```
    *(You may need to run `pm2 startup` one time to configure the startup script for your OS.)*

### Step 3.4: Run Caddy

1.  **Navigate to `ai-ascent` Project:** Caddy should be run from the directory containing the `Caddyfile`.
    ```bash
    cd C:\Projects\ai-ascent
    ```

2.  **Start Caddy:** Run Caddy. It will automatically find the `Caddyfile` in the current directory.
    ```bash
    caddy run
    ```
    *   Caddy will now handle incoming requests for both domains, automatically provision SSL certificates, and route traffic to the correct application running under PM2.

## 4. Final Verification

*   Navigate to `https://aiascent.game` in your browser. You should see the game.
*   Navigate to `https://aiascent.dev` in your browser. You should see the promotional website.
*   The setup is complete. Caddy and PM2 will ensure both sites remain online and are served securely.